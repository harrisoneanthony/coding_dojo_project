{% extends 'base.html' %}
{% block title %} Create Event {% endblock %}
{% block content %}
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDyZWSyzkDoh8tieaORQh_iXNMSpwuADVM&callback=initMap&libraries=places&v=weekly" defer></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=default" defer></script>
<script>
      /**
       * @license
       * Copyright 2019 Google LLC. All Rights Reserved.
       * SPDX-License-Identifier: Apache-2.0
       */
      // This example requires the Places library. Include the libraries=places
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">
      function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 40.749933, lng: -73.98633 },
          zoom: 13,
          mapTypeControl: false,
        });
        const card = document.getElementById("pac-card");
        const input = document.getElementById("pac-input");
        const biasInputElement = document.getElementById("use-location-bias");
        const strictBoundsInputElement =
          document.getElementById("use-strict-bounds");
        const options = {
          fields: ["formatted_address", "geometry", "name"],
          strictBounds: false,
          types: ["establishment"],
        };

        map.controls[google.maps.ControlPosition.TOP].push(card);

        const autocomplete = new google.maps.places.Autocomplete(
          input,
          options
        );

        // Bind the map's bounds (viewport) property to the autocomplete object,
        // so that the autocomplete requests use the current map bounds for the
        // bounds option in the request.
        autocomplete.bindTo("bounds", map);

        const infowindow = new google.maps.InfoWindow();
        const infowindowContent = document.getElementById("infowindow-content");

        infowindow.setContent(infowindowContent);

        const marker = new google.maps.Marker({
          map,
          anchorPoint: new google.maps.Point(0, -29),
        });

        autocomplete.addListener("place_changed", () => {
          infowindow.close();
          marker.setVisible(false);

          const place = autocomplete.getPlace();

          if (!place.geometry || !place.geometry.location) {
            // User entered the name of a Place that was not suggested and
            // pressed the Enter key, or the Place Details request failed.
            window.alert(
              "No details available for input: '" + place.name + "'"
            );
            return;
          }

          // If the place has a geometry, then present it on a map.
          if (place.geometry.viewport) {
            map.fitBounds(place.geometry.viewport);
          } else {
            map.setCenter(place.geometry.location);
            map.setZoom(17);
          }

          marker.setPosition(place.geometry.location);
          marker.setVisible(true);
          infowindowContent.children["place-name"].textContent = place.name;
          infowindowContent.children["place-address"].textContent =
            place.formatted_address;
          infowindow.open(map, marker);
        });

        // Sets a listener on a radio button to change the filter type on Places
        // Autocomplete.
        function setupClickListener(id, types) {
          const radioButton = document.getElementById(id);

          radioButton.addEventListener("click", () => {
            autocomplete.setTypes(types);
            input.value = "";
          });
        }

        setupClickListener("changetype-all", []);
        setupClickListener("changetype-address", ["address"]);
        setupClickListener("changetype-establishment", ["establishment"]);
        setupClickListener("changetype-geocode", ["geocode"]);
        setupClickListener("changetype-cities", ["(cities)"]);
        setupClickListener("changetype-regions", ["(regions)"]);
        biasInputElement.addEventListener("change", () => {
          if (biasInputElement.checked) {
            autocomplete.bindTo("bounds", map);
          } else {
            // User wants to turn off location bias, so three things need to happen:
            // 1. Unbind from map
            // 2. Reset the bounds to whole world
            // 3. Uncheck the strict bounds checkbox UI (which also disables strict bounds)
            autocomplete.unbind("bounds");
            autocomplete.setBounds({
              east: 180,
              west: -180,
              north: 90,
              south: -90,
            });
            strictBoundsInputElement.checked = biasInputElement.checked;
          }

          input.value = "";
        });
        strictBoundsInputElement.addEventListener("change", () => {
          autocomplete.setOptions({
            strictBounds: strictBoundsInputElement.checked,
          });
          if (strictBoundsInputElement.checked) {
            biasInputElement.checked = strictBoundsInputElement.checked;
            autocomplete.bindTo("bounds", map);
          }

          input.value = "";
        });
      }

      window.initMap = initMap;
</script>
<style>
/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* SPDX-License-Identifier: Apache-2.0
*/
/* 
* Always set the map height explicitly to define the size of the div element
* that contains the map. 
*/
#map {
height: 200px;
}

/* 
* Optional: Makes the sample page fill the window. 
*/
body {
height: 100%;
width: 100%;
margin: 0;
padding: 0;
}
.form_group_right {
    padding-left: 10px;
}
#description {
font-family: Roboto;
font-size: 15px;
font-weight: 300;
}

#infowindow-content .title {
font-weight: bold;
}

#infowindow-content {
display: none;
}

#pac-card {
position: static;
background-color: #fff;
border: 0;
border-radius: 2px;
box-shadow: 0 1px 4px -1px rgba(0, 0, 0, 0.3);
margin: 10px;
padding: 0 0.5em;
font: 400 18px Roboto, Arial, sans-serif;
overflow: hidden;
font-family: Roboto;
padding: 0; 
}

#pac-container {
padding-bottom: 12px;
margin-right: 12px;
}

.pac-controls {
display: inline-block;
padding: 5px 11px;
}

.pac-controls label {
font-family: Roboto;
font-size: 13px;
font-weight: 300;
}

#pac-input {
background-color: #fff;
font-family: Roboto;
font-size: 15px;
font-weight: 300;
margin-left: 12px;
padding: 0 11px 0 13px;
text-overflow: ellipsis;
width: 400px;
}

#pac-input:focus {
border-color: #4d90fe;
}

#title {
color: #fff;
background-color: #4d90fe;
font-size: 25px;
font-weight: 500;
padding: 6px 12px;
}
</style>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
            <li class="nav-item active">
                <a class="nav-link" href="/dashboard">Home </span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/create/event">Create Event</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/search">Search</a>
            </li>
        </ul>
    </div>
    <div class="sub-header">
        <div>
            <form  action="/logout">
                <button class="action_button bg-warning" type="submit">Logout</button>
            </form>
        </div>
    </div>
</nav> 

<body>
    <h1>Create your event</h1>
    {% if messages %}
            <ul class="messages justify-content-around">
                {% for message in messages %}
                    <li {% if message.tags %} class="{{message.tags}}" {% endif %}>
                        {{message}}
                    </li>
                {% endfor %}
            </ul>
    {% endif %}
    <div class="d-flex flex-wrap justify-content-around">
        <form action="/create_event" method="POST" class="index_forms bg-primary-subtle border">
            {% csrf_token %}
            <div class="form_container d-flex flex-wrap justify-content-space-between">
                <div class="form_group_left">
                    <div class="form_group">
                        <label for="title">Event title:</label>
                        <input type="text" name="title" class="form-control">
                    </div>
                    <div class="form_group">
                        <label for="date">Date:</label>
                        <input type="date" name="date" class="form-control">
                    </div>
                    <div class="form_group">
                        <label for="time">Time:</label>
                        <input type="time" name="time" class="form-control">
                    </div>
                    <div class="form_group">
                        <label for="max_attendees">Max Attendees:</label>
                        <input type="int" name="max_attendees" class="form-control">
                    </div>
                    <div class="form_group">
                        <label for="information">Information:</label>
                        <input type="text" name="information" class="form-control">
                    </div>
                </div>
                <div class="form_group_right">
                    <div class="form_group">
                        <label for="location">Location:</label>
                        <div class="pac-card">
                            <div>
                                <div id="title">Autocomplete search</div>
                                <div id="type-selector" class="pac-controls">
                                    <input
                                    type="radio"
                                    name="type"
                                    id="changetype-all"
                                    checked="checked"
                                    />
                                    <label for="changetype-all">All</label>
                                    
                                    <input type="radio" name="type" id="changetype-establishment" />
                                    <label for="changetype-establishment">establishment</label>
                                    
                                    <input type="radio" name="type" id="changetype-address" />
                                    <label for="changetype-address">address</label>
                                    
                                    <input type="radio" name="type" id="changetype-geocode" />
                                            <label for="changetype-geocode">geocode</label>
                                            
                                            <input type="radio" name="type" id="changetype-cities" />
                                            <label for="changetype-cities">(cities)</label>
                                            
                                            <input type="radio" name="type" id="changetype-regions" />
                                            <label for="changetype-regions">(regions)</label>
                                        </div>
                                        <br />
                                        <div id="strict-bounds-selector" class="pac-controls">
                                            <input type="checkbox" id="use-location-bias" value="" />
                                            <label for="use-location-bias">Bias to map viewport</label>
                                            
                                            <input type="checkbox" id="use-strict-bounds" value="" />
                                            <label for="use-strict-bounds">Strict bounds</label>
                                        </div>
                                    </div>
                                    <div id="pac-container">
                                        <label for="location"></label>
                                        <input id="pac-input" type="text" name="location" placeholder="Enter a location" />
                                    </div>
                                    <div id="map"></div>
                                    <div id="infowindow-content">
                                        <span id="place-name" class="title"></span><br/>
                                        <span id="place-address"></span>
                                    </div>
                                </div>           
                    </div>
                </div>
            </div>
            <input type="submit" value="Create event" class="action_button bg-success-subtle">
        </form>
</body>
{% endblock %}